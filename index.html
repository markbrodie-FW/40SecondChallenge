<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Leaderboard — Display</title>
  <style>
    :root{
      --bg:#0e0f12; --panel:#151822; --muted:#9aa3af; --text:#e5e7eb; --accent:#7dd3fc; --border:#1f2633;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;background:var(--bg);color:var(--text);padding-bottom:56px}
    .container{max-width:1100px;margin:0 auto;padding:20px}
    header{display:flex;align-items:center;justify-content:center;margin-bottom:16px}
    .big{font-size:clamp(26px,4vw,44px);font-weight:800;letter-spacing:.3px;text-align:center}
    .panel{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:16px}
    .table-wrap{overflow:auto;border:1px solid var(--border);border-radius:16px}
    table{width:100%;border-collapse:separate;border-spacing:0}
    th,td{padding:12px 14px;border-bottom:1px solid var(--border)}
    th{position:sticky;top:0;background:#10131b;color:var(--muted);text-align:left;font-weight:600}
    tr:last-child td{border-bottom:none}
    .rank{font-variant-numeric:tabular-nums;font-weight:700}
    .time{font-variant-numeric:tabular-nums}
    .badge{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--border);border-radius:999px;padding:6px 10px;color:var(--muted);font-size:12px}
    .fullscreen-btn{position:fixed;right:16px;bottom:70px;z-index:40}
    button{appearance:none;border:1px solid var(--border);background:#0b0d13;color:var(--text);padding:10px 14px;border-radius:10px;cursor:pointer}
    a{color:inherit;opacity:.8}

    /* New footer anchored to bottom */
    .footer-status{position:fixed;left:0;right:0;bottom:0;z-index:30;display:flex;justify-content:center;gap:10px;padding:10px 14px;background:rgba(10,12,18,0.8);backdrop-filter:saturate(130%) blur(4px);border-top:1px solid var(--border)}
  </style>
  <style>
  :root{
    --brand:#121FA2;   /* deep blue */
    --accent:#73BCFB;  /* light blue */
    --highlight:#FFF35F; /* yellow */
    --bg:#0b0f2b;
    --panel:#0f143f;
    --muted:#c9d6ff;
    --text:#ffffff;
    --border: rgba(255,255,255,0.08);
  }
  body{
    background:
      radial-gradient(1000px 500px at 15% 10%, rgba(18,31,162,0.25), transparent),
      radial-gradient(900px 500px at 85% 90%, rgba(255,243,95,0.12), transparent),
      var(--bg);
    color: var(--text);
  }
  th{ background: var(--brand) !important; color: #fff !important; }
  .table-wrap{ border-color: var(--border) !important; }
  .badge{
    color: var(--accent) !important;
    border-color: rgba(115,188,251,0.40) !important;
    background: rgba(115,188,251,0.06) !important;
  }
  a{ color: var(--accent) !important; opacity: 1 !important; }
</style>

</head>
<body>
  <div class="container">
    <header>
      <div class="big" id="screen-title">Leaderboard</div>
    </header>

    <div class="table-wrap">
      <table aria-label="Leaderboard table">
        <thead>
          <tr>
            <th style="width:90px">Rank</th>
            <th>Name</th>
            <th style="width:160px">Time</th>
          </tr>
        </thead>
        <tbody id="display-tbody"></tbody>
      </table>
    </div>
  </div>

  <!-- Fixed footer shows counts and last updated -->
  <footer class="footer-status" aria-live="polite">
    <span class="badge" id="entry-count">0 entries</span>
    <span class="badge" id="last-updated">Updated —</span>
  </footer>

  <button class="fullscreen-btn" id="btn-fullscreen" title="Enter fullscreen">⤢ Fullscreen</button>

  <script>
    // Shared keys with admin.html
    const STORAGE_KEY = 'leaderboardEntries:v1';
    const SETTINGS_KEY = 'leaderboardSettings:v1';

    function getEntries(){ try{ return JSON.parse(localStorage.getItem(STORAGE_KEY))||[] }catch{ return [] } }
    function getSettings(){ try{ return JSON.parse(localStorage.getItem(SETTINGS_KEY))||{title:'Leaderboard',topN:'',rotateSeconds:0} }catch{ return {title:'Leaderboard',topN:'',rotateSeconds:0} } }

    function formatMs(ms){ if(!Number.isFinite(ms)) return '—'; const s=Math.floor(ms/1000); const m=Math.floor(s/60); const sec=s%60; const msPart=ms%1000; return `${m}:${sec.toString().padStart(2,'0')}.${msPart.toString().padStart(3,'0')}` }

    function sortedEntries(){ const list=getEntries().slice(); list.sort((a,b)=> a.timeMs-b.timeMs || a.created.localeCompare(b.created)); return list }

    const screenTitle=document.getElementById('screen-title');
    const entryCount=document.getElementById('entry-count');
    const lastUpdated=document.getElementById('last-updated');
    const displayTbody=document.getElementById('display-tbody');

    let rotateIndex=0, rotateTimer=null;

    function render(){
      const s = getSettings();
      const all = sortedEntries();
      const topN = s.topN ? Math.max(1, Number(s.topN)) : null;
      const list = topN ? all.slice(0, topN) : all;

      screenTitle.textContent = s.title || 'Leaderboard';
      entryCount.textContent = `${all.length} entr${all.length===1?'y':'ies'}`;
      const updated = localStorage.getItem('leaderboardLastUpdated');
      lastUpdated.textContent = updated ? `Updated ${new Date(updated).toLocaleString()}` : 'Updated —';

      displayTbody.innerHTML = '';
      list.forEach((e, idx)=>{
        const tr=document.createElement('tr');
        tr.innerHTML = `<td class=\"rank\">${idx+1}</td><td>${escapeHtml(e.name)}</td><td class=\"time\">${formatMs(e.timeMs)}</td>`;
        displayTbody.appendChild(tr);
      });

      if (rotateTimer) clearInterval(rotateTimer);
      const secs = Number(s.rotateSeconds)||0;
      if (secs>0 && list.length>0){
        const rows = [...displayTbody.querySelectorAll('tr')];
        const tick=()=>{ rows.forEach(r=> r.style.background=''); const r=rows[rotateIndex%rows.length]; r.style.background='rgba(125,211,252,0.08)'; rotateIndex++; };
        tick(); rotateTimer=setInterval(tick, secs*1000);
      }
    }

    // Fallback polling so this works even with file:// URLs where storage events don't propagate between files.
    setInterval(render, 2000);
    window.addEventListener('storage', (e)=>{ if([STORAGE_KEY, SETTINGS_KEY, 'leaderboardLastUpdated'].includes(e.key)) render(); });

    // Fullscreen
    document.getElementById('btn-fullscreen').addEventListener('click', ()=>{
      const el = document.documentElement; if (!document.fullscreenElement){ el.requestFullscreen?.(); } else { document.exitFullscreen?.(); }
    });

    function escapeHtml(s){ return (''+s).replace(/[&<>\"]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;'}[c])); }

    // First render & demo seed if empty
    (function init(){
      if (!localStorage.getItem(STORAGE_KEY)){
        const demo=[
          {id:crypto.randomUUID(), name:'Ava', timeMs:72345, created:new Date().toISOString()},
          {id:crypto.randomUUID(), name:'Noah', timeMs:70123, created:new Date().toISOString()},
          {id:crypto.randomUUID(), name:'Mia', timeMs:76543, created:new Date().toISOString()}
        ];
        localStorage.setItem(STORAGE_KEY, JSON.stringify(demo));
        localStorage.setItem('leaderboardLastUpdated', new Date().toISOString());
      }
      if (!localStorage.getItem(SETTINGS_KEY)){
        localStorage.setItem(SETTINGS_KEY, JSON.stringify({title:'Leaderboard', topN:'', rotateSeconds:0}));
      }
      render();
    })();
  </script>
</body>
</html>